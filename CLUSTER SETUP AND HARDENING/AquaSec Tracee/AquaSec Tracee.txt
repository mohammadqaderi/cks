- AquaSec Tracee

- It's an open-source tool from Aqua security used to trace syscalls on a container

- It makes use of EBPF (Extended Berkeley Packet Filter) that can run programs directly in the kernel space without
  interfering with kernel source code.

- EBPF are used to create tools like Aqua Security Tracee that can monitor the OS and detect suspicious behavior

- When we run Tracee as a docker container, it builds the EBPF program and stores it at /tmp/tracee directory by default.

- To make sure that this program can be built once and used for successive runs we can bind mount the directory
  /tmp/tracee from the host to the container.

- In order to compile the EBPF program Tracee needs access to kernel headers which an ubuntu under /lib/modules
  and its dependencies under /usr/src

- Hence we need to bind mount these directories as well in the container in read-only mode.

- For tracing syscalls, Tracee needs additional capabilities on the host.
  - Using --privileged flag on docker is an easy way to get started.

- To observe the syscalls generated by a single command such as ls, run the docker container like this:
  docker run --name tracee --rm --privileged --pid=host \
  -v /lib/modules/:/lib/modules/:ro -v /usr/src:/usr/src:ro \
  -v /tmp/tracee:/tmp/tracee aquasec/tracee:0.4.0 --trace comm=ls

- To observe the syscalls for all new processes on the host, run the container like this:
  docker run --name tracee --rm --privileged --pid=host \
  -v /lib/modules/:/lib/modules/:ro -v /usr/src:/usr/src:ro \
  -v /tmp/tracee:/tmp/tracee aquasec/tracee:0.4.0 --trace pid=new

- To observe the syscalls generated by a new container, run the container like this:
  docker run --name tracee --rm --privileged --pid=host \
  -v /lib/modules/:/lib/modules/:ro -v /usr/src:/usr/src:ro \
  -v /tmp/tracee:/tmp/tracee aquasec/tracee:0.4.0 --trace container=new