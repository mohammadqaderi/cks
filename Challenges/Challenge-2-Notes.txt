- Docker file Part
 - Run as non root(instead, use correct application user)
 - Avoid exposing unnecessary ports
 - Avoid copying the Dockerfile and other unnecessary files and directories in to the image.
  Move the required files and directories (app.py, requirements.txt and the templates directory)
  to a subdirectory called app under webapp and update the COPY instruction in the Dockerfile accordingly.
 - Once the security issues are fixed, rebuild this image locally with the tag kodekloud/webapp-color:stable

Solution:
- COPY instruction in the Dockerfile accordingly to ./app
COPY ./app /opt
- Run as non root
Change the line USER root to USER worker

- Avoid exposing unnecessary ports. We don't need port 22 (SSH) for the app, so delete the following lines
## Expose port 22
EXPOSE 22

- Move the app and related files to a new subdirectory app
mkdir app
mv app.py app/
mv requirements.txt app/
mv templates app/

- Rebuild image
docker build -t kodekloud/webapp-color:stable .
-------------------------------------------------------------------------------

- dev-webapp pod Part
Ensure that the pod dev-webapp is immutable:
- This pod can be accessed using the kubectl exec command. We want to make sure that this does not happen.
 Use a startupProbe to remove all shells before the container startup. Use initialDelaySeconds
 and periodSeconds of 5. Hint: For this to work you would have to run the container as root!
Image used: kodekloud/webapp-color:stable (We have already done this above)
Redeploy the pod as per the above recommendations and make sure that the application is up.

Solution:
- Check what shells are present in the container - shell commands are found in /bin directory
and usually end with sh, e.g. sh itself, bash etc.
kubectl exec -n dev dev-webapp -- ls /bin | grep sh

- Create a startup probe according to the specification, and ensure the startup probe can run as root.
 Note that the probes aren't affected by the USER command in the Dockerfile.
Add the following under securityContext: runAsUser: 0
startupProbe:
  exec:
    command:
    - rm
    - /bin/sh
    - /bin/ash
  initialDelaySeconds: 5
  periodSeconds: 5
Now recreate the running pod with everything we changed in step 2 and this step
kubectl replace -f dev-webapp.yaml --force

